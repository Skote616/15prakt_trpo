<Page x:Class="DBFirst.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:DBFirst.Pages"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converters="clr-namespace:DBFirst.Converters" xmlns:valid="clr-namespace:DBFirst.Validators"
      mc:Ignorable="d" 
      DataContext="{Binding RelativeSource={RelativeSource Self}}"
      d:DesignHeight="450" d:DesignWidth="800"
      Title="MainPage">

    <Page.Resources>
        <converters:CategoryConverter x:Key="categoryConverter"/>
        <converters:TagsConverter x:Key="tagsConverter"/>
    </Page.Resources>
    <Grid Margin="5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2">
            <Label>Поиск</Label>
            <TextBox Text="{Binding searchQuery, UpdateSourceTrigger=PropertyChanged}" materialDesign:HintAssist.Hint="Введите текст для поиска" TextChanged="TextBox_TextChanged"/>
        </StackPanel>
        
        <StackPanel Grid.Row="1" Grid.Column="0">
            <Label>Сортировка</Label>
            <ComboBox Name="combo" SelectionChanged="ComboBox_SelectionChanged">
                <ComboBox.Items>
                    <ComboBoxItem Tag="Name">Наименование</ComboBoxItem>
                    <ComboBoxItem Tag="PriceUp">Цена по возрастанию</ComboBoxItem>
                    <ComboBoxItem Tag="PriceDown">Цена по убыванию</ComboBoxItem>
                    <ComboBoxItem Tag="StockUp">Количество по возрастаию</ComboBoxItem>
                    <ComboBoxItem Tag="StockDown">Количество по убыванию</ComboBoxItem>
                </ComboBox.Items>
            </ComboBox>
            <StackPanel>
                <Label>Фильтр по категории</Label>
                <TextBox x:Name="f1" Text="{Binding filterCategory, UpdateSourceTrigger=PropertyChanged}" TextChanged="TextBox_TextChanged"/>
            </StackPanel>
            <StackPanel>
                <Label>Фильтр по бренду</Label>
                <TextBox x:Name="f2" Text="{Binding filterBrand, UpdateSourceTrigger=PropertyChanged}" TextChanged="TextBox_TextChanged"/>
            </StackPanel>
            <StackPanel>
                <Label>Фильтр по цене</Label>
                <Label>от</Label>
                <TextBox Name="f3" Validation.ErrorTemplate="{x:Null}" TextChanged="TextBox_TextChanged" >
                    <TextBox.Text>
                        <Binding Path="filterHeightFrom" UpdateSourceTrigger="PropertyChanged">
                            <Binding.ValidationRules>
                                <valid:NumberValidation ValidatesOnTargetUpdated="True"/>
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <ItemsControl ItemsSource="{Binding ElementName=f3,Path=(Validation.Errors)}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock FontSize="8" Text="{Binding ErrorContent}"  Style="{StaticResource ValidationErrorText}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <Label>до</Label>
                <TextBox Name="f4" Validation.ErrorTemplate="{x:Null}" TextChanged="TextBox_TextChanged" >
                    <TextBox.Text>
                        <Binding Path="filterHeightTo" UpdateSourceTrigger="PropertyChanged">
                            <Binding.ValidationRules>
                                <valid:NumberValidation ValidatesOnTargetUpdated="True"/>
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <ItemsControl ItemsSource="{Binding ElementName=f4,Path=(Validation.Errors)}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock FontSize="8" Text="{Binding ErrorContent}"  Style="{StaticResource ValidationErrorText}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
            <Button Margin="5" Click="Button_Click">Сбросить</Button>
        </StackPanel>

        <materialDesign:ColorZone  Grid.Row="1" Grid.Column="1" Mode="SecondaryMid">
            <ListView  x:Name="productList" HorizontalContentAlignment="Stretch" Margin="0,10,0,0" MouseDoubleClick="EditCard" MaxHeight="300">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="BorderBrush" Value="Black"/>
                        <Setter Property="BorderThickness" Value="0.5"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Stock}" Value="0">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="1">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="2">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="3">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="4">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="5">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="6">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="7">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="8">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Stock}" Value="9">
                                <Setter Property="BorderBrush" Value="#ffd129"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock FontSize="14" FontWeight="Bold" Text="{Binding Name}"/>
                                <TextBlock Margin="0,0,0,10">
                                    <Run FontSize="14" Foreground="Orange" Text="★"/>
                                    <Run Text="{Binding Rating}"/>
                                </TextBlock>
                                <TextBlock Margin="0,0,0,10" Text="{Binding CategoryId, Converter={StaticResource categoryConverter}}"/>
                                <TextBlock Margin="0,0,0,10">
                                <Run Text="{Binding Description}"/>         
                                </TextBlock>
                                <TextBlock>
                                
                                <Run Text="{Binding Tags, Converter={StaticResource tagsConverter}}"/>
                                </TextBlock>
                            </StackPanel>
                            <StackPanel Grid.Column="1">
                                <TextBlock HorizontalAlignment="Right" Margin="0,0,0,10">
                                <Run Text="Цена "/>
                                <Run Text="{Binding Price, StringFormat={}{0:F2}}"/>
                                </TextBlock>
                                <TextBlock Margin="0,0,0,10"/>
                                <TextBlock Margin="0,0,0,4"></TextBlock>
                                <TextBlock HorizontalAlignment="Right" x:Name="stockBox">
                                <Run Text="Остаток: "/>
                                <Run Text="{Binding Stock}"/>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </materialDesign:ColorZone>
        <WrapPanel Grid.Row="2" Grid.ColumnSpan="2">
            <TextBlock/>
            <TextBlock/>
        </WrapPanel>
        <WrapPanel Grid.Row="2" Grid.ColumnSpan="2">
            <TextBlock x:Name="allPr"/>
            <TextBlock Text="{Binding Items.Count, ElementName=productList,StringFormat='{} Показано: {0}'}"/>
        </WrapPanel>
        <WrapPanel Grid.Row="1" Grid.Column="1" VerticalAlignment="Bottom">
            <Button Click="AddProduct">Добавить товар</Button>
            <Button Click="ChangeCategory" Margin="5,0,5,0">Категории</Button>
            <Button Click="ChangeTags" Margin="0,0,5,0">Теги</Button>
            <Button Click="ChangeBrands">Бренды</Button>

        </WrapPanel>
    </Grid>
</Page>
